<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><title>Lab4 FAQ</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head><body><h1> Lab7 FAQ</h1><p> 	This document contains Frequently Asked Questions,  which are relevant to completing the week's labassignment.  Any Questions may be posted to <a href="mailto:cspp51081@cs.uchicago.edu">cspp51081</a>.	</p><h3>How to remove Message Queues, Shared Memory Seqments and Semaphores </h3><p>     When you create an IPC structure, the Operating System Kernel allocates memory to storeand maintain the structure.  This means you can reuse the structure.  You should also make sure you remove the structure when you are finished, otherwise it can sit in memory a long, longtime.  (The Kernel cannot really garbage collect these structures.  Why?  The reason thesestructures were introduced was to allow unrelated processes to communicate; so the Kernel canhave no way of knowing when user processes are finished with the IPC structures.</p><p>     Removal can take place in two ways:  On the command line and in your program.  You cansee a display of what structures your machine is maintianing by the command <code>ipcs</code>.  This will display the key value, id, and owner of all Shared Memory segments,Message Queues and Semaphores the system is maintaining.  When you find the <em>id</em> for thestructure you want to remove, you execute one of the commands<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>ipcrm msg</code> <em>id</em> <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>ipcrm shm</code> <em>id</em> <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>ipcrm sem</code> <em>id</em> <BR><BR>Depending on which type of structure you want to remove.  <code>man 1</code> has detailson using these functions.     </p><p>    To remove an IPC structure from within your program, you will use one of the <em>ctl</em>functions (depending on the type of structure):<BR><BR> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code> int msgctl(msqid, IPC_RMID, NULL)</code><BR> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code>int shmctl(shmid, IPC_RMID, NULL); </code><BR> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code> int  semctl (semid, 0, IPC_RMID, 0) </code><BR><BR> These functions must be called by a process whose user ID is that of the creator of the  structure.  Any processes using the structure at the time it is removed, return immediately with error messages.  See <code>man 2</code> for the type and use of these functions:  they do ALOT.</p><h3> Declaring <code>union semun</code> for use with <code>semctl</code></h3><p>    This posting is if you recieve the following message, when implementing semaphores:<BR><BR> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code>union semun my_semun;</code>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp <code>// a declaration in your program</code>  <BR><BR> COMPILER RESPONSE:  <BR> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code> storage size of `my_semun' isn't known </code><BR><BR>  The problem is that although the fourth argument to <code>semctl</code> is of type <code>union semun</code><BR><BR> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code>int  semctl ( int semid, int semnun, int cmd, union semun arg); </code> <BR><BR>  there is actually no type <code>union semun</code> defined.  To remedy this, you will have to define this union type in your program, before you enter <code>main</code>:<BR><BR><code>        union semun { <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    int val; /* used for SETVAL only */ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                        struct semid_ds *buf; /* for IPC_STAT and IPC_SET */ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                        ushort *array;  /* used for GETALL and SETALL */ <BR>       };  <BR><BR></code>       </p>  </body></html>
